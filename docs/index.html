<html><head><title>JWT Toolkit</title><link rel="stylesheet" type="text/css" href="./screen.css"/></head><body><div class="Wrapper"><h1>JWT Toolkit</h1><section><h2>Modules</h2><div><div><h3>JWTRequest</h3><div><div><h4><span>JWTRequest()</span></h4><p class="FunctionDetail"><span><span>function </span>JWTRequest(<span class="Param Param-indent">requestFunction<span class="ParamTypes">: <span>(<span class="Param ">jwt<span class="ParamTypes">: <span>string</span></span></span>)<span><span> =&gt; </span><span class="ParamTypes"><span>Promise</span></span></span></span></span><span>, </span></span><span class="Param Param-indent">renewTokenFunction<span class="ParamTypes">: <span>(<span class="Param ">err<span class="ParamTypes">: <span>*</span></span></span>)<span><span> =&gt; </span><span class="ParamTypes"><span>Promise.&lt;string&gt;</span></span></span></span></span><span>, </span></span><span class="Param Param-indent">initialJwt<span class="ParamTypes">: <span>string</span></span></span>)<span><span>: </span><span class="ParamTypes"><span>Promise</span></span></span></span></p><div><p>JWTRequest is designed to handle trying and retrying XHR requests using JWT.
As JWTs can expire without the front-end knowing about it, inevitably requests are sometimes sent with expired JWTs.
The back end will often respond with an appropriate error and  status code to indicate that the token has expired.
The front-end must then request a new token and retry the original request (or set of requests) with the new token.
This function handles that try-fail-renew-retry pattern.</p>
<p>Any new responses that arrive while a token is being renewed will be queued and fired once the new token is received.</p></div><div><pre class="Example"><span class="token keyword" >const</span> requestFunction<span class="token punctuation" >:</span> Function <span class="token operator" >=</span> <span class="token punctuation" >(</span>jwt<span class="token punctuation" >:</span> string<span class="token punctuation" >)</span><span class="token punctuation" >:</span> Promise<span class="token operator" >&lt;</span><span class="token operator" >*</span><span class="token operator" >></span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
     <span class="token keyword" >const</span> headers <span class="token operator" >=</span> Token<span class="token punctuation" >.</span><span class="token function" >asHeaders</span><span class="token punctuation" >(</span>jwt<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
     <span class="token keyword" >return</span> <span class="token function" >coolRequest</span><span class="token punctuation" >(</span>headers<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

<span class="token keyword" >const</span> renewTokenFunction<span class="token punctuation" >:</span> Function <span class="token operator" >=</span> <span class="token punctuation" >(</span>err<span class="token punctuation" >:</span> <span class="token operator" >*</span><span class="token punctuation" >)</span><span class="token punctuation" >:</span> <span class="token operator" >?</span>Promise<span class="token tag" ><span class="token tag" ><span class="token punctuation" >&lt;</span>string</span><span class="token punctuation" >></span></span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
    <span class="token keyword" >if</span><span class="token punctuation" >(</span>err <span class="token operator" >&amp;&amp;</span> err<span class="token punctuation" >.</span>status <span class="token operator" >==</span> <span class="token number" >401</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token keyword" >return</span> <span class="token function" >renewMyToken</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>
    <span class="token keyword" >return</span> <span class="token keyword" >null</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

<span class="token function" >JWTRequest</span><span class="token punctuation" >(</span>requestFunction<span class="token punctuation" >,</span> renewTokenFunction<span class="token punctuation" >,</span> <span class="token string" >"myTokenStringHere"</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span></pre></div><div class="ParamList"><h5>Params</h5><ul><li class="ParamListItem"><strong>requestFunction</strong><span class="ParamTypes">: <span>(<span class="Param ">jwt<span class="ParamTypes">: <span>string</span></span></span>)<span><span> =&gt; </span><span class="ParamTypes"><span>Promise</span></span></span></span></span> - <span><p>A function that makes the request you want when.
It is passed the JWT string to use in your request, and must return a promise that should be resolved / rejected when your request resolves / rejects.</p></span></li><li class="ParamListItem"><strong>renewTokenFunction</strong><span class="ParamTypes">: <span>(<span class="Param ">err<span class="ParamTypes">: <span>*</span></span></span>)<span><span> =&gt; </span><span class="ParamTypes"><span>Promise.&lt;string&gt;</span></span></span></span></span> - <span><p>A function that makes a request to get a new JWT. It must return a promise containing the new JWT string.</p></span></li><li class="ParamListItem"><strong>initialJwt</strong><span class="ParamTypes">: <span>string</span></span> - <span><p>The JWT to attempt to use for the initial request.</p></span></li></ul></div><div class="ParamList"><h5>Returns</h5><ul><li class="ParamListItem"><strong></strong><span class="ParamTypes"><span>Promise</span></span> - <span><p>A promise that will be resolved once the request is complete, after any necessary renewing and retrying.
It will be rejected if the response indicates an error has occured (not counting errors due to expired tokens).</p></span></li></ul></div></div></div></div><div><h3>Token</h3><div><div><h4><span>isValid()</span></h4><p class="FunctionDetail"><span><span>function </span>isValid(<span class="Param Param-indent">token<span class="ParamTypes">: <span>string</span></span></span>)<span><span>: </span><span class="ParamTypes"><span>boolean</span></span></span></span></p><div><p>Tests if the token is valid.</p></div><div><pre class="Example"><span class="token keyword" >import</span> Token <span class="token keyword" >from</span> <span class="token string" >'jwt-toolkit'</span><span class="token punctuation" >;</span>
Token<span class="token punctuation" >.</span><span class="token function" >isValid</span><span class="token punctuation" >(</span><span class="token string" >"NOT A TOKEN"</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">// returns false</span></pre></div><div class="ParamList"><h5>Params</h5><ul><li class="ParamListItem"><strong>token</strong><span class="ParamTypes">: <span>string</span></span> - <span><p>JWT string</p></span></li></ul></div><div class="ParamList"><h5>Returns</h5><ul><li class="ParamListItem"><strong></strong><span class="ParamTypes"><span>boolean</span></span> - <span><p>A boolean indicating if the token is valid (true) or not (false)</p></span></li></ul></div></div><div><h4><span>isExpired()</span></h4><p class="FunctionDetail"><span><span>function </span>isExpired(<span class="Param Param-indent">token<span class="ParamTypes">: <span>string</span></span></span>)<span><span>: </span><span class="ParamTypes"><span>boolean</span></span></span></span></p><div><p>Tests if the token is expired according to the client's clock.
Be careful with this one, as it can be incorrect if you don't compensate for possible differences between the client's clock and the server's.</p></div><div><pre class="Example"><span class="token keyword" >import</span> Token <span class="token keyword" >from</span> <span class="token string" >'jwt-toolkit'</span><span class="token punctuation" >;</span>
Token<span class="token punctuation" >.</span><span class="token function" >isExpired</span><span class="token punctuation" >(</span><span class="token string" >"eyJhbGciOiJIU..."</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span></pre></div><div class="ParamList"><h5>Params</h5><ul><li class="ParamListItem"><strong>token</strong><span class="ParamTypes">: <span>string</span></span> - <span><p>JWT string</p></span></li></ul></div><div class="ParamList"><h5>Returns</h5><ul><li class="ParamListItem"><strong></strong><span class="ParamTypes"><span>boolean</span></span> - <span><p>A boolean indicating if the token is expired / invalid (true) or has time remaining (false)</p></span></li></ul></div></div><div><h4><span>asHeaders()</span></h4><p class="FunctionDetail"><span><span>function </span>asHeaders(<span class="Param Param-indent">token<span class="ParamTypes">: <span>string</span></span></span>)<span><span>: </span><span class="ParamTypes"><span>Object</span></span></span></span></p><div><p>Returns an object containing JWT as authorization headers.</p></div><div><pre class="Example"><span class="token keyword" >import</span> Token <span class="token keyword" >from</span> <span class="token string" >'jwt-toolkit'</span><span class="token punctuation" >;</span>
Token<span class="token punctuation" >.</span><span class="token function" >asHeaders</span><span class="token punctuation" >(</span><span class="token string" >"eyJhbGciOiJIU..."</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">// returns { Authorization: 'Bearer eyJhbGciOiJIU...' }</span></pre></div><div class="ParamList"><h5>Params</h5><ul><li class="ParamListItem"><strong>token</strong><span class="ParamTypes">: <span>string</span></span> - <span><p>JWT string</p></span></li></ul></div><div class="ParamList"><h5>Returns</h5><ul><li class="ParamListItem"><strong></strong><span class="ParamTypes"><span>Object</span></span> - <span><p>Headers object with JWT as authorization header</p></span></li></ul></div></div></div></div></div></section></div></body></html>